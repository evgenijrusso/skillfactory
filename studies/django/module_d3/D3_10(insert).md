# D3.10. DML. Создание записей. INSERT

### Следующий оператор в нашем списке — INSERT. Этот оператор создаёт новые записи в таблице.

Базовая форма оператора:

INSERT INTO
имя_таблицы(имя_столбца_1, ..., имя_столбца_n)
VALUES
(значение_столбца_1, ..., значение_столбца_n),
...
(значение_столбца_1, ..., значение_столбца_n);

### Пример 1. Создание нескольких категорий товаров
INSERT INTO
    categories(name)
VALUES
    ('Музыкальные инструменты'),
    ('Профессиональное музыкальное оборудование'),
    ('Любительское музыкальное оборудование');

Данный запрос создаст три категории товаров. 
Обратите внимание, что несмотря на то, что в таблице категории есть два атрибута (id, name), 
в запросе мы указываем только name. Это связано с тем, что атрибут id создан с типом данных SERIAL, 
а значит, его значение будет увеличиваться на 1 при каждом новом создании записи. 
СУБД сама запишет очередное значение для поля id, мы можем об этом поле не беспокоиться при создании записей.

```
-- вставка
INSERT INTO manufacturers(name, website)
VALUES ('Fender', 'fender.com'), ('Gibson','gibson.com'), ('Roland', 'roland.com');
-- чтение
SELECT * FROM manufacturers;
```

### Пример 2. Создание связей между категориями и товарами
Таблица связей содержит ссылки на категории и товары. 
Чтобы связать конкретные товары с конкретными категориями, мы должны создать записи в таблице.

INSERT INTO products_categories(product_id, category_id)
VALUES (1, 1), (1, 2), (3, 1), (3, 3);
Оператор INSERT достаточно прост, однако существуют две дополнительных возможности этого оператора, о которых следует знать.

- Иногда требуется получить значения полей, созданных БД автоматически при вставке записей. 
Например, когда мы создавали категории, то для атрибута id были автоматически сгенерированы и 
записаны в БД значения для каждой новой записи. Конечно, можно прочитать все данные в таблице 
и найти новые записи по имени, но это неудобно. В таких случаях используется ключевое слово RETURNING, 
которое позволяет вернуть значения атрибутов созданных записей.


Тогда запрос:
```
TRUNCATE TABLE   products_categories,  categories,  manufacturers,  vendors,  products;

INSERT INTO
  categories(name)
VALUES
  ('Музыкальные инструменты'),
  ('Профессиональное музыкальное оборудование'),
  ('Любительское музыкальное оборудование')
RETURNING id;
```
Даст результат: 7,8,9 (explain)
Как видите, новые записи получили id 7,8,9.

2. Бывает, что вставляемые записи нарушают некоторое ограничение. 
3. Например, мы попытаемся добавить товар с отрицательной ценой. 
4. В этом случае можно использовать ключевое слово ON CONFLICT для указания действия в случае нарушения ограничения. 
5. Описание смотрите в документации к оператору по ссылке.

===============================   Замечания по добавление данных в базе catalog3 ===============
Есть проблема с добавлением данных INSERT INTO TABLE product, product_category;
ПРи очистке данных таблицы product нужно вместо 
- TRUNCATE TABLE product 
добавить либо еще 'product_category' либо TRUNCATE TABLE product CASCADE;  
